generator client {
  provider = "prisma-client"
  output   = "../lib/prisma"
}

datasource db {
  provider = "postgresql"
}

// --- USER ROLES FOR AUTHORIZATION ---
enum UserRole {
  USER  // Regular customer
  ADMIN // Admin dashboard access
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  role          UserRole  @default(USER)
  wishlist      Wishlist?
  accounts      Account[]
  sessions      Session[]
  reviews       Review[]
  
  // Email preferences
  emailNotifications Boolean @default(true)
  marketingEmails    Boolean @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  cart      Cart?
  orders    Order[]
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
}

// --- GLOBAL STORE SETTINGS ---
model StoreSetting {
  id String @id @default("global")

  // Header / Top Bar
  topBarEmail   String  @default("mhhasanul@gmail.com")
  topBarPhone   String  @default("(12345)67890")
  allowLanguage Boolean @default(true)
  allowCurrency Boolean @default(true)

  // Brand
  logoText String @default("Hekto")

  // Store Configuration
  currency String @default("NGN")
  taxRate Float @default(7.5)

  // Footer General
  footerAddress String @default("17 Princess Road, London, Greater London NW1 8JR, UK")
  copyright     String @default("Â©Webecy - All Rights Reserved")

  updatedAt DateTime @updatedAt
}

// --- NAVIGATION & FOOTER LINKS ---
model LinkGroup {
  id      String      @id @default(cuid())
  title   String
  section LinkSection @default(FOOTER)
  links   NavLink[]
  order   Int         @default(0)
}

model NavLink {
  id      String    @id @default(cuid())
  label   String
  url     String
  groupId String
  group   LinkGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  order   Int       @default(0)
}

enum LinkSection {
  HEADER_MAIN
  FOOTER
}

// --- CONTACT FORM SUBMISSIONS ---
model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String?
  message   String   @db.Text
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

// --- STATIC PAGES / FAQ ---
model PageContent {
  id        String   @id @default(cuid())
  slug      String   @unique
  title     String
  content   String   @db.Text
  isActive  Boolean  @default(true)
  updatedAt DateTime @updatedAt
}

// --- NEWSLETTER ---
model NewsletterSubscriber {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())
}

// --- HERO BANNER ---
model HeroBanner {
  id String @id @default(cuid())

  subTitle    String
  mainTitle   String
  description String @db.Text

  buttonText String @default("Shop Now")
  buttonLink String @default("/shop")

  imageUrl   String
  offTagText String?

  isActive  Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id                 String @id @default(cuid())
  name               String
  code               String @unique
  price              Float
  discountPercentage Float? @default(0)

  imageUrl        String
  description     String? @db.Text
  longDescription String? @db.Text
  additionalInfo  String? @db.Text

  specs Json? @default("{}")
  
  // Inventory fields
  stock           Int      @default(0)
  lowStockThreshold Int    @default(5)
  trackInventory  Boolean  @default(true)

  images ProductImage[]
  stockMovements StockMovement[]
  stockAlerts StockAlert[]

  tags     String[]
  colors   String[]
  size     String[] @default(["XL"])
  isActive Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  categoryId String?
  category   Category? @relation(fields: [categoryId], references: [id])
  reviews    Review[]

  promoBanners  PromoBanner[]
  discountItems DiscountItem[]
  cartItems     CartItem[]
  wishlistItems WishlistItem[]
  orderItems    OrderItem[]

  @@index([tags])
  @@index([categoryId])
  @@index([stock])
}

model ProductImage {
  id        String  @id @default(cuid())
  url       String
  isMain    Boolean @default(false)
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

model Review {
  id      String  @id @default(cuid())
  rating  Int
  comment String? @db.Text

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
}

model Service {
  id          String   @id @default(cuid())
  title       String
  description String
  iconUrl     String?
  iconName    String?
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PromoBanner {
  id       String   @id @default(cuid())
  title    String
  features String[]

  productId String
  product   Product @relation(fields: [productId], references: [id])

  customImage String?

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TrendingPromo {
  id       String  @id @default(cuid())
  title    String
  linkText String
  linkUrl  String
  imageUrl String
  bgColor  String
  isActive Boolean @default(true)
}

model Category {
  id       String  @id @default(cuid())
  name     String  @unique
  slug     String  @unique
  imageUrl String?

  products     Product[]
  discountItem DiscountItem?
  showOnTop    Boolean       @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DiscountItem {
  id          String   @id @default(cuid())
  title       String
  subtitle    String
  description String   @db.Text
  features    String[]
  buttonText  String   @default("Shop Now")

  categoryId String   @unique
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Brand {
  id        String   @id @default(cuid())
  name      String
  imageUrl  String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
}

model Newsletter {
  id         String @id @default(cuid())
  title      String @default("Get Latest Update By Subscribe Our Newsletter")
  bgImage    String @default("/images/newsletter-bg.png")
  buttonText String @default("Shop Now")
}

model BlogPost {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  content     String   @db.Text
  excerpt     String   @db.Text
  author      String   @default("SoberAli")
  mainImage   String
  publishedAt DateTime @default(now())
  
  category    String   @default("General")
  tags        String[] @default([])
  isFeatured  Boolean  @default(false)
  
  videoUrl    String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([category])
}

model Cart {
  id        String     @id @default(cuid())
  userId    String?    @unique
  user      User?      @relation(fields: [userId], references: [id], onDelete: Cascade)
  sessionId String?    @unique // For guest carts
  items     CartItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([sessionId])
}

model CartItem {
  id     String @id @default(cuid())
  cartId String
  cart   Cart   @relation(fields: [cartId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id])

  quantity Int     @default(1)
  color    String?
  size     String?

  @@unique([cartId, productId, color, size])
}

model Wishlist {
  id        String         @id @default(cuid())
  userId    String         @unique
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     WishlistItem[]
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
}

model WishlistItem {
  id         String   @id @default(cuid())
  wishlistId String
  wishlist   Wishlist @relation(fields: [wishlistId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([wishlistId, productId])
}

model Order {
  id          String @id @default(cuid())
  orderNumber Int    @unique @default(autoincrement())

  userId        String?
  user          User?   @relation(fields: [userId], references: [id])
  customerEmail String

  firstName  String
  lastName   String
  address    String
  apartment  String?
  city       String
  country    String  @default("Bangladesh")
  postalCode String
  phone      String?

  subtotal      Float
  totalAmount   Float
  status        OrderStatus @default(PENDING)
  paymentStatus String      @default("UNPAID")
  
  trackingNumber String?
  estimatedDelivery DateTime?

  items OrderItem[]
  emailLogs EmailLog[]
  stockMovements StockMovement[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([customerEmail])
  @@index([status])
}

model OrderItem {
  id      String @id @default(cuid())
  orderId String
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  productId String
  product   Product @relation(fields: [productId], references: [id])

  quantity Int
  price    Float
  color    String?
  size     String?
}

model Testimonial {
  id        String   @id @default(cuid())
  name      String
  role      String
  content   String   @db.Text
  imageUrl  String
  isActive  Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

model Faq {
  id        String   @id @default(cuid())
  question  String
  answer    String   @db.Text
  createdAt DateTime @default(now())
}

// --- EMAIL SYSTEM ---

enum EmailType {
  ORDER_CONFIRMATION
  ORDER_STATUS_UPDATE
  SHIPPING_NOTIFICATION
  DELIVERY_CONFIRMATION
  MARKETING
  PASSWORD_RESET
}

enum EmailStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
  BOUNCED
}

model EmailTemplate {
  id          String    @id @default(cuid())
  name        String    @unique
  type        EmailType
  subject     String
  htmlContent String    @db.Text
  textContent String?   @db.Text
  variables   String[]
  isActive    Boolean   @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  emailLogs EmailLog[]
  
  @@index([type])
}

model EmailLog {
  id         String      @id @default(cuid())
  templateId String?
  template   EmailTemplate? @relation(fields: [templateId], references: [id])
  
  orderId    String?
  order      Order?      @relation(fields: [orderId], references: [id])
  
  recipient  String
  subject    String
  content    String      @db.Text
  status     EmailStatus @default(PENDING)
  
  sentAt     DateTime?
  deliveredAt DateTime?
  errorMessage String?
  
  createdAt DateTime @default(now())
  
  @@index([recipient])
  @@index([status])
  @@index([sentAt])
}

// --- INVENTORY SYSTEM ---

enum StockMovementType {
  SALE
  RESTOCK
  ADJUSTMENT
  RETURN
  DAMAGE
  TRANSFER
}

model StockMovement {
  id          String            @id @default(cuid())
  productId   String
  product     Product           @relation(fields: [productId], references: [id])
  
  orderId     String?
  order       Order?            @relation(fields: [orderId], references: [id])
  
  type        StockMovementType
  quantity    Int
  previousStock Int
  newStock    Int
  
  reason      String?
  reference   String?
  
  createdBy   String?
  createdAt   DateTime          @default(now())
  
  @@index([productId])
  @@index([type])
  @@index([createdAt])
}

model StockAlert {
  id          String   @id @default(cuid())
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  
  alertType   String
  threshold   Int
  currentStock Int
  
  isResolved  Boolean  @default(false)
  resolvedAt  DateTime?
  
  createdAt   DateTime @default(now())
  
  @@index([productId])
  @@index([isResolved])
}